<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Registro - Beneficiarios</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;200;600;200&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="centered-page">
    <div style="width:100%; max-width:720px;">
      <div class="form-card">
        <form class="form-pills" id="signupForm">
          <input class="pill-input" name="nombre" type="text" placeholder="Nombre" required>
          <input class="pill-input" name="apellido" type="text" placeholder="Apellido" required>
          <input class="pill-input" name="telefono" type="tel" placeholder="Telefono">
          <input class="pill-input" name="matricula" type="text" placeholder="Matricula">
          <input class="pill-input" name="cuatrimestre" type="text" placeholder="Cuatrimestre">
          <input class="pill-input" name="correo" type="email" placeholder="Correo" required>
          <input class="pill-input" name="contrasena" type="password" placeholder="Contraseña" required>
          <div class="submit-row"><button class="submit-btn" type="submit">Crear cuenta</button></div>
        </form>
      </div>
    </div>
  </div>
    <script>
      (function(){
        var form = document.getElementById('signupForm');
        if (!form) return;

        // pequeño toast/confirmación
        var toast = document.createElement('div');
        toast.textContent = 'Cuenta creada';
        toast.style.cssText = 'position:fixed;left:50%;top:18px;transform:translateX(-50%);background:#f2c1c2;color:#3b0709;padding:10px 18px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.12);display:none;z-index:9999;font-weight:700;font-family:inherit;';
        document.body.appendChild(toast);

        form.addEventListener('submit', async function(e){
          e.preventDefault();

          // recolectar datos del formulario y mapear nombres a lo que espera el backend
          var inputs = form.querySelectorAll('input[name]');
          var values = {};
          inputs.forEach(function(inp){ values[inp.name] = inp.value; });

          var payload = {
            name: values.nombre,
            apellido: values.apellido || null,
            telefono: values.telefono || null,
            matricula: values.matricula || null,
            cuatrimestre: values.cuatrimestre || null,
            email: values.correo,
            password: values.contrasena,
            // indicate this signup is for a beneficiary so backend saves id_rol accordingly
            roleName: 'beneficiario'
          };

          
          try {
            var resp = await fetch('http://localhost:3000/signup', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });

            if (resp.ok) {
              toast.textContent = 'Cuenta creada correctamente';
              toast.style.display = 'block';
              setTimeout(function(){
                toast.style.display = 'none';
                window.location.href = 'login.html';
              }, 900);
            } else {
              var err = await resp.json().catch(()=>({ error: 'Unknown error' }));
              toast.textContent = (err && err.error) ? err.error : 'Error al crear cuenta';
              toast.style.display = 'block';
              setTimeout(function(){ toast.style.display = 'none'; }, 2000);
            }
          } catch (networkErr) {
            console.error('Network error:', networkErr);
            toast.textContent = 'No se pudo conectar al servidor';
            toast.style.display = 'block';
            setTimeout(function(){ toast.style.display = 'none'; }, 2000);
          }
        });
      })();
    </script>
</body>
</html>
